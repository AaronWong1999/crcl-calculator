# Circle (CRCL) 战略投资计算器逻辑文档

## 1. 项目概述
这是一个用于模拟 Circle (CRCL) 股票分批建仓策略的单页应用 (SPA)。核心目的是对比不同抗跌保护系数（7% vs 10%）下的平均持仓成本、总股数以及在未来目标估值（5000亿/7500亿美元）下的潜在回报。

## 2. 核心逻辑与常数

### 2.1 总股本推算 (Implied Shares)
为了确保估值模型与截图中的数据完全一致，我们通过“底仓”数据反推总股本：
*   **基准市值 (Base Market Cap)**: $15.356 Billion (153.56 亿美元)
*   **基准价格 (Base Price)**: $65.20
*   **总股本 (Implied Shares)**: 
    $$ \text{Shares} = \frac{15,356,000,000}{65.20} \approx 235,521,472 \text{ (约 2.355 亿股)} $$

### 2.2 目标估值模型
计算器基于两个长期目标估值来计算潜在回报：
1.  **$500B (5000亿美元)**
    *   目标股价: $500,000,000,000 / \text{Shares} \approx \$2,122.95$
2.  **$750B (7500亿美元)**
    *   目标股价: $750,000,000,000 / \text{Shares} \approx \$3,184.42$

---

## 3. 策略方案 (Scenarios)

### 3.1 方案 A (7% 保护)
*   **特点**: 跌幅步进较小 (~7%)，补仓更频繁，适合温和回调。
*   **价格序列**: $65.20 \to 60.89 \to 56.84 \to \dots \to 35.20$

### 3.2 方案 B (10% 保护)
*   **特点**: 跌幅步进较大 (~10%)，补仓间隔大，抗跌能力更强，追求极致低成本。
*   **价格序列**: $65.20 \to 59.70 \to 54.65 \to \dots \to 29.50$

---

## 4. 动态计算公式

表格中的每一行及顶部指标卡片均根据用户输入的 **初始资金** 和 **补仓资金** 实时计算。

### 4.1 单行计算 (Row Calculation)
对于第 $n$ 档：
*   **挂单价格 ($P_n$)**: 硬编码在策略数组中。
*   **挂单数量 ($Q_n$)**: 
    *   若 $n=0$ (底仓): $Q_0 = \text{Round}(\text{BaseInvest} / P_0)$
    *   若 $n>0$ (补仓): $Q_n = \text{Round}(\text{StepInvest} / P_n)$
*   **本轮投入 ($I_n$)**: $Q_n \times P_n$ （注：代码中简化为直接使用 BaseInvest/StepInvest 作为名义投入累加，实际精确计算依赖 $Q \times P$）

### 4.2 累计指标 (Cumulative Metrics)
*   **累计投资 ($I_{cum}$)**: $\sum I_n$
*   **累计股数 ($Q_{cum}$)**: $\sum Q_n$
*   **持仓均价 ($P_{avg}$)**: $I_{cum} / Q_{cum}$
*   **累计成本市值**:
    $$ \text{MV}_{cost} = \frac{P_{avg} \times \text{TotalShares}}{100,000,000} \text{ (单位: 亿美元)} $$

### 4.3 价值回报 (Projected Returns)
*   **5000亿价值**: $Q_{cum} \times \text{TargetPrice}_{500B}$
*   **7500亿价值**: $Q_{cum} \times \text{TargetPrice}_{750B}$

---

## 5. 交互逻辑

### 5.1 顶部指标卡 (Top Metrics)
为了直观对比两种策略的“终局”差异，顶部指标卡显示的是 **当前选中策略完全执行后（Projected）** 的数据，而非当前已成交的数据。
*   **Plan Total**: 策略执行完的总投入。
*   **Break-even**: 策略执行完的最终均价。
*   **Proj. ROI**: 基于最终均价与目标估值的回报率。

### 5.2 实时状态 (Real-time Status)
*   用户输入 **当前市场价格 (Current Market Price)**。
*   系统遍历表格：
    *   若 $P_{current} \le P_n$，该行被标记为 **EXECUTED (已成交)** (绿色高亮)。
    *   若 $|P_{current} - P_n| < 0.5$，该行被标记为 **Active Zone** (蓝色高亮)。
*   这允许用户快速查看当前价格处于策略的哪个阶段。

### 5.3 Tab 切换
切换 Tab 会完全重绘表格并更新顶部指标卡，使用户能立即看到不同策略对最终均价和 ROI 的影响。
